---
- name: copy ceph admin keyring
  block:
    - name: get keys from monitors
      ceph_key:
        name: client.admin
        cluster: "{{ cluster }}"
        output_format: plain
        state: info
      register: _admin_key
      delegate_to: "{{ groups.get(mon_group_name)[0] }}"
      run_once: true

    - name: copy ceph key(s) if needed
      copy:
        dest: "/etc/ceph/{{ cluster }}.client.admin.keyring"
        content: "{{ _admin_key.stdout + '\n' }}"
        owner: "{{ ceph_uid if containerized_deployment | bool else 'ceph' }}"
        group: "{{ ceph_uid if containerized_deployment | bool else 'ceph' }}"
        mode: "{{ ceph_keyring_permissions }}"
  when:
    - cephx | bool
    - copy_admin_key | bool
