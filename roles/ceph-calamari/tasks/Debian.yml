---
## Common to all the Ceph Debian nodes
#

- name: Fail on unsupported system
  fail: msg="System not supported {{ ansible_system }}"
  when: ansible_system not in ['Linux']

- name: Fail on unsupported architecture
  fail: msg="Architecture not supported {{ ansible_architecture }}"
  when: ansible_architecture not in ['x86_64']

- name: Fail on unsupported distribution
  fail: msg="Distribution not supported {{ ansible_os_family }}"
  when: ansible_os_family not in ['Debian', 'RedHat']

- name: Install dependancies
  apt: pkg={{ item }} state=present update_cache=yes cache_valid_time=3600 # we update the cache just in case...
  with_items:
    - apache2
    - libapache2-mod-wsgi
    - libcairo2
    - supervisor
    - python-cairo
    - libpq5
    - postgresql

- name: Install Calamari packages
  apt: deb={{ item }}
  with_items:
    - calamari-server_1.2-119-ge5c8f55_all.deb
    - calamari-clients_1.2-38-gb571421_all.deb

- name: Initialize Calamari
  command: calamari-ctl initialize
