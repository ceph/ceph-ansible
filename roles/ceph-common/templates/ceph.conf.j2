#jinja2: lstrip_blocks: True
# {{ ansible_managed }}

{% if final_ceph_config is defined %}
  {# Create the section #}
  {% for option, value in final_ceph_config.iteritems() %}
    {% if value is not mapping -%}
      {% if value is string -%}
        {{ option }} = {{ value }}
      {% elif value is number -%}
        {{ option }} = {{ value | lower }}
      {% endif %}
    {% elif value is mapping -%}
      [{{ option }}]
    {% endif %}
    {# Fill the section with options #}
    {% for suboption, subvalue in value.iteritems() -%}
      {% if subvalue is not mapping -%}
        {{ suboption }} = {{ subvalue | lower }}
      {% endif %}
    {% endfor %}
      {% if option == "mon": %}
{% if groups['mons'] is defined %}
{%- for host in groups['mons'] -%}
{% if hostvars[host]['ansible_hostname'] is defined %}
  [mon.{{ hostvars[host]['ansible_hostname'] }}]
    host = {{ hostvars[host]['ansible_hostname'] }}
    mon addr = {{ hostvars[host]['ansible_' + monitor_interface ]['ipv4']['address'] }}
{% endif %}
{% endfor %}
{% endif %}
      {% endif %}
      {% if option == "mds": %}
{% if groups['mdss'] is defined %}
{% for host in groups['mdss'] %}
{% if hostvars[host]['ansible_hostname'] is defined %}
  [mds.{{ hostvars[host]['ansible_hostname'] }}]
    host = {{ hostvars[host]['ansible_hostname'] }}
{% endif %}
{% endfor %}
{% endif %}
      {% endif %}
      {% if option == "rgw": %}
{% if groups['rgws'] is defined %}
{% for host in groups['rgws'] %}
{% if hostvars[host]['ansible_hostname'] is defined %}
[client.radosgw.{{ hostvars[host]['ansible_hostname'] }}]
  {% if radosgw_dns_name is defined %}
    rgw dns name = {{ radosgw_dns_name }}
  {% endif %}
  host = {{ hostvars[host]['ansible_hostname'] }}
  keyring = /var/lib/ceph/radosgw/ceph-radosgw.{{ hostvars[host]['ansible_hostname'] }}/keyring
  rgw socket path = /tmp/radosgw-{{ hostvars[host]['ansible_hostname'] }}.sock
  log file = /var/log/ceph/radosgw-{{ hostvars[host]['ansible_hostname'] }}.log
  rgw data = /var/lib/ceph/radosgw/ceph-radosgw.{{ hostvars[host]['ansible_hostname'] }}
  rgw print continue = false
{% endif %}
{% endfor %}
{% endif %}
{% endif %}
