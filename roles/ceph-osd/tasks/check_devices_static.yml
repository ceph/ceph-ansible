---
- name: check the partition status of the osd disks
  shell: "parted --script {{ item }} print > /dev/null 2>&1"
  with_items: "{{ legacy_devices + storage_devices}}"
  changed_when: false
  failed_when: false
  register: osd_partition_status_results

# NOTE: The following calls to sgdisk are retried because sgdisk is known to
# fully wipe a device the first time around. There is no need to halt execution
# of zapping the whole device so these try again. It is easier to use `||` to
# keep the current flow of the task.
# See: https://github.com/ceph/ceph-ansible/issues/759
- name: fix partitions gpt header or labels of the osd disks
  shell: "sgdisk --zap-all --clear --mbrtogpt -- {{ item }} || sgdisk --zap-all --clear --mbrtogpt -- {{ item }}"
  with_items: "{{ legacy_devices + storage_devices }}"
  changed_when: false
