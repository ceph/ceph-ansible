---
- name: check if osd and mds range is not filtered (osd hosts)
  local_action:
    module: shell
      set -o pipefail && nmap -p 6800-7300 {{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }} | grep -sqo -e filtered -e '0 hosts up'
  changed_when: false
  failed_when: false
  register: osdrangestate
  check_mode: no
  when:
    - osd_group_name in group_names
    - nmapexist.rc == 0

- name: fail if osd and mds range is filtered (osd hosts)
  fail:
      msg: "Please allow range from 6800 to 7300 on your firewall"
  when:
    - osd_group_name in group_names
    - nmapexist.rc == 0
    - osdrangestate.rc == 0
