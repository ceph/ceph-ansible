---
# NOTE (leseb) : this task is for disk devices only because of the explicit use of the first
# partition.

- name: activate osd(s) when device is a disk
  ceph_disk:
    cluster: "{{ cluster }}"
    data: "{{ item }}{%- if 'nvme' in item or 'cciss' in item or 'loop' in item %}{{ 'p' }}{%- endif %}{%- if 'mpath' in item %}{{ '-part' }}{%- endif %}{{ '1' }}"
    dmcrypt: "{{ dmcrypt }}"
    action: activate
  with_items:
    - "{{ devices|unique }}"
  environment:
    CEPH_CONTAINER_IMAGE: "{{ ceph_docker_registry + '/' + ceph_docker_image + ':' + ceph_docker_image_tag if containerized_deployment | bool else None }}"
  when:
    - not osd_auto_discovery
    - item != '/dev/dead'
