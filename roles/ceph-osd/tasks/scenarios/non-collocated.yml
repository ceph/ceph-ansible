---
- name: prepare ceph "{{ osd_objectstore }}" osd disk(s) non-collocated
  ceph_disk:
    cluster: "{{ cluster }}"
    objectstore: filestore
    data: "{{ item.2 }}"
    journal: "{{ item.1 }}"
    dmcrypt: "{{ dmcrypt }}"
    action: prepare
  with_together:
    - "{{ parted_results.results | default([]) }}"
    - "{{ devices }}"
    - "{{ dedicated_devices }}"
  changed_when: false
  environment:
    CEPH_CONTAINER_IMAGE: "{{ ceph_docker_registry + '/' + ceph_docker_image + ':' + ceph_docker_image_tag if containerized_deployment | bool else None }}"
  when:
    - osd_objectstore == 'filestore'
    - item.0.partitions|length == 0

- name: manually prepare ceph "{{ osd_objectstore }}" osd disk(s) with a dedicated device for db
  ceph_disk:
    cluster: "{{ cluster }}"
    objectstore: bluestore
    data: "{{ item.2 }}"
    db: "{{ item.1 }}"
    dmcrypt: "{{ dmcrypt }}"
    action: prepare
  with_together:
    - "{{ parted_results.results | default([]) }}"
    - "{{ dedicated_devices }}"
    - "{{ devices | unique }}"
  environment:
    CEPH_CONTAINER_IMAGE: "{{ ceph_docker_registry + '/' + ceph_docker_image + ':' + ceph_docker_image_tag if containerized_deployment | bool else None }}"
  when:
    - osd_objectstore == 'bluestore'
    - item.0.partitions|length == 0
    - bluestore_wal_devices|length == 0

- name: manually prepare ceph "{{ osd_objectstore }}" osd disk(s) with a dedicated device for db and wal
  ceph_disk:
    cluster: "{{ cluster }}"
    objectstore: bluestore
    data: "{{ item.3 }}"
    db: "{{ item.1 }}"
    wal: "{{ item.2 }}"
    dmcrypt: "{{ dmcrypt }}"
    action: prepare
  with_together:
    - "{{ parted_results.results | default([]) }}"
    - "{{ dedicated_devices }}"
    - "{{ bluestore_wal_devices }}"
    - "{{ devices | unique }}"
  environment:
    CEPH_CONTAINER_IMAGE: "{{ ceph_docker_registry + '/' + ceph_docker_image + ':' + ceph_docker_image_tag if containerized_deployment | bool else None }}"
  when:
    - osd_objectstore == 'bluestore'
    - item.0.partitions|length == 0
    - bluestore_wal_devices|length > 0
