---
## SCENARIO 1: JOURNAL AND OSD_DATA ON THE SAME DEVICE

- include: ../check_devices.yml

# NOTE (leseb): the prepare process must be parallelized somehow...
# if you have 64 disks with 4TB each, this will take a while
# since Ansible will sequential process the loop

# NOTE (alahouze): if the device is a partition, the parted command below has
# failed, this is why we check if the device is a partition too.
- name: automatic prepare filestore osd disk(s) without partitions with collocated osd data and journal
  command: ceph-disk prepare --cluster "{{ cluster }}" "{{ item }}"
  register: prepared_osds
  with_items: "{{ legacy_devices + storage_devices }}"
  when:
    - journal_collocation
    - osd_auto_discovery

- name: manually prepare filestore osd disk(s) with collocated osd data and journal
  command: "ceph-disk prepare --cluster {{ cluster }} {{ item }}"
  with_items: "{{ legacy_devices + storage_devices }}"
  when:
    - journal_collocation
    - not osd_auto_discovery

- include: ../activate_osds.yml
