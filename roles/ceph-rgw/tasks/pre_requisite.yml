---
- name: create rgw keyrings
  ceph_key:
    name: "client.rgw.{{ ansible_hostname }}.{{ item.instance_name }}"
    cluster: "{{ cluster }}"
    user: "client.bootstrap-rgw"
    user_key: /var/lib/ceph/bootstrap-rgw/{{ cluster }}.keyring
    dest: "/var/lib/ceph/radosgw/{{ cluster }}-rgw.{{ ansible_hostname }}.{{ item.instance_name }}/keyring"
    caps:
      osd: 'allow rwx'
      mon: 'allow rw'
    import_key: False
    owner: "ceph"
    group: "ceph"
    mode: "0600"
  with_items: "{{ rgw_instances }}"
  when: cephx | bool