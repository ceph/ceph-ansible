- name: creates logical volumes for the bucket index or fs journals on a single device. 
  become: true
  hosts: osds

  tasks:

  - name: include vars of lv_vars.yaml
    include_vars:
      file: lv_vars.yaml
    failed_when: false

  # need to check if lvm2 is installed
  - name: install lvm2
    package:
      name: lvm2
      state: present
    register: result
    until: result is succeeded

  - include_role:
      name: ceph-lvm-create
    vars:
      nvme_device: "{{ outer.nvme_device | default('dummy')}}"
      hdd_devices: "{{ outer.hdd_devices }}"
      nvme_device_lvs: "{{ outer.nvme_device_lvs }}"
    with_items:
     - "{{ lvm_devices }}"
    loop_control:
      loop_var: outer
